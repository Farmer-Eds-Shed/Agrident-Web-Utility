<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Agrident Web Utility</title>
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <h1>Agrident Web Utility</h1>
  <div class="muted">Agrident/Allflex Data Downloader</div>

  <!-- Connection / Status -->
  <div class="card cardCompact" id="connCard">
    <div class="topRow" id="connTypeRow">
      <label for="connType">Connection:</label>
      <select id="connType">
        <option value="ble">Bluetooth (BLE)</option>
        <option value="serial">USB Serial (COM)</option>
      </select>
      <span class="muted mlAuto" id="connHint"></span>
    </div>

    <div class="btnRow mt8">
      <button id="connectBtn">Connect</button>
      <button id="disconnectBtn" disabled>Disconnect</button>
    </div>

    <div class="pillRow mt8">
      <span id="status" class="pill bad">Disconnected</span>
      <span id="busy" class="pill">idle</span>
    </div>

    <details id="connMore" class="connMore">
      <summary>Connection details</summary>
      <div class="connMeta">
        <span class="muted" id="deviceName"></span>
        <span class="muted" id="syncedAt"></span>
      </div>
    </details>
  </div>

  <!-- Tabs -->
  <div class="card">
   <div class="row gap10 mb10">
      <button class="btn btnSmall btnPrimary" id="tabGroupsBtn" type="button">Groups</button>
      <button class="btn btnSmall" id="tabTasksBtn" type="button">Tasks</button>
      <button class="btn btnSmall" id="tabTaglistBtn" type="button">Taglist</button>
      <button class="btn btnSmall" id="tabSettingsBtn" type="button">Settings</button>
      <span class="muted" style="margin-left:auto;" id="activeTabHint">Groups</span>
    </div>

    <!-- Tasks panel -->
    <div id="panelTasks" style="display:none;">
      <div class="row gap10 mb10">
        <button class="btn btnSmall" id="syncTasksBtn" disabled>Sync Tasks</button>

        <label class="muted" for="taskSelect">Task:</label>
        <select id="taskSelect" disabled>
          <option value="">(connect to load tasks)</option>
        </select>

        <label class="muted" for="taskFilter">Search:</label>
        <input id="taskFilter" type="text" placeholder="Search…" disabled>

        <button id="downloadCsvBtn" disabled>Download CSV</button>
      </div>

      <h3 class="mb6">Preview</h3>
      <div class="muted" id="previewMeta">No task selected.</div>

      <div class="scroll scrollTall">
        <table>
          <thead><tr id="previewHead"></tr></thead>
          <tbody id="previewBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Groups panel -->
    <div id="panelGroups">
      <div class="row gap10 mb10">
        <button class="btn btnSmall" id="syncGroupsBtn" disabled>Sync Groups</button>

        <label class="muted" for="groupSelect">Group:</label>
        <select id="groupSelect" disabled>
          <option value="">(sync groups)</option>
        </select>

        <label class="muted" for="groupFilter">Search:</label>
        <input id="groupFilter" type="text" placeholder="Search…" disabled>

        <label class="muted inlineCheck">
          <input type="checkbox" id="preferGroupX" checked />
          EID + Weight
        </label>

        <button id="downloadGroupCsvBtn" disabled>Download Group CSV</button>
      </div>

      <h3 class="mb6">Preview</h3>
      <div class="muted" id="groupPreviewMeta">No group selected.</div>

      <div class="scroll scrollTall">
        <table>
          <thead><tr id="groupPreviewHead"></tr></thead>
          <tbody id="groupPreviewBody"></tbody>
        </table>
      </div>

      <div class="muted mt8" id="groupsSyncedAt"></div>
    </div>
  </div>


  <!-- Taglist & Alerts panel -->
  <div id="panelTaglist" style="display:none;">
    <div class="card">
      <div class="row gap10 mb10">
        <button class="btn" id="syncTaglistBtn" disabled>Sync Device</button>
        <button class="btn" id="useDeviceAsDraftBtn" disabled>Use Device as Draft</button>

        <button class="btn btnDanger" id="eraseTaglistBtn" disabled>Erase Device Taglist</button>

        <label class="muted" for="taglistUploadMode">Upload mode:</label>
        <select id="taglistUploadMode" disabled>
          <option value="append" selected>Append</option>
          <option value="replace">Replace (erase then upload)</option>
        </select>
      </div>

      <div class="row gap10 mb10">
        <label class="muted" for="taglistFile">Load CSV as Draft:</label>
        <input id="taglistFile" type="file" accept=".csv,text/csv" disabled>

        <button class="btn" id="downloadTaglistCsvBtn" disabled>Export Draft CSV</button>
        <button class="btn" id="addTagRowBtn" disabled>Add Row</button>
        <button class="btn btnPrimary" id="uploadTaglistBtn" disabled>Upload Draft → Wand</button>

        <label class="muted" for="taglistFilter">Filter:</label>
        <input id="taglistFilter" type="text" placeholder="Filter draft…" disabled>
      </div>

      <div class="muted" id="taglistMeta">Taglist — not loaded.</div>

      <div class="scroll scrollTall">
        <table>
          <thead><tr id="taglistHead"></tr></thead>
          <tbody id="taglistBody"></tbody>
        </table>
      </div>
    </div>


    <div class="card">
      <div class="row gap10 mb10">
        <button class="btn" id="syncAlertsBtn" disabled>Sync Device</button>
        <button class="btn" id="useAlertsAsDraftBtn" disabled>Use Device as Draft</button>

        <button class="btn btnDanger" id="eraseAlertsBtn" disabled>Erase Device Alerts</button>

        <label class="muted" for="alertsUploadMode">Upload mode:</label>
        <select id="alertsUploadMode" disabled>
          <option value="append" selected>Append</option>
          <option value="replace">Replace (erase then upload)</option>
        </select>

        <label class="muted" for="alertsFilter">Filter:</label>
        <input id="alertsFilter" type="text" placeholder="Filter draft…" disabled>
      </div>

      <div class="row gap10 mb10">
        <label class="muted" for="alertsFile">Load CSV as Draft:</label>
        <input id="alertsFile" type="file" accept=".csv,text/csv" disabled>

        <button class="btn" id="downloadAlertsCsvBtn" disabled>Export Draft CSV</button>
        <button class="btn" id="addAlertRowBtn" disabled>Add Row</button>
        <button class="btn btnPrimary" id="uploadAlertsBtn" disabled>Upload Draft → Wand</button>
      </div>

      <div class="muted" id="alertsMeta">Alerts — not loaded.</div>

      <div class="scroll scrollTall">
        <table>
          <thead><tr id="alertsHead"></tr></thead>
          <tbody id="alertsBody"></tbody>
        </table>
      </div>
    </div>
  </div>


  <!-- Settings panel -->
  <div id="panelSettings" style="display:none;">
    <div class="card">
      <div class="row gap10 mb10">
        <button class="btn" id="syncSettingsBtn" disabled>Sync Device</button>
        <button class="btn" id="useSettingsAsDraftBtn" disabled>Use Device as Draft</button>

        <label class="muted" for="settingsFile">Load JSON as Draft:</label>
        <input id="settingsFile" type="file" accept=".json,application/json" disabled>

        <button class="btn" id="downloadSettingsBtn" disabled>Export Draft JSON</button>
        <button class="btn" id="addSettingRowBtn" disabled>Add Row</button>
        <button class="btn btnPrimary" id="uploadSettingsBtn" disabled>Upload Draft → Wand</button>

        <label class="muted" for="settingsFilter">Filter:</label>
        <input id="settingsFilter" type="text" placeholder="Filter draft…" disabled>
      </div>

      <div class="muted" id="settingsMeta">Settings — not loaded.</div>

      <div class="scroll scrollTall">
        <table>
          <thead><tr id="settingsHead"></tr></thead>
          <tbody id="settingsBody"></tbody>
        </table>
      </div>

      <div class="muted mt8" id="settingsInfo"></div>
    </div>
  </div>


  <!-- Modal editor -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <div class="modalTitle" id="modalTitle">Edit Row</div>
        <span class="modalSubtitle" id="modalSubtitle"></span>
        <span class="modalHeaderSpacer"></span>
        <button class="btn btnSmall" id="modalCloseBtn" title="Close">✕</button>
      </div>

      <div class="modalBody">
        <div class="muted" style="margin-bottom:10px;">
          Tip: Date columns accept <code>08022026</code>, <code>08-02-26</code>, <code>2026-02-08</code> and will export as <code>dd/mm/yyyy</code>.
        </div>
        <div id="modalGrid" class="grid"></div>
      </div>

      <div class="modalFooter">
        <button class="btn" id="modalCancelBtn">Cancel</button>
        <button class="btn btnDanger" id="modalDeleteBtn">Delete Row</button>
        <button class="btn btnPrimary" id="modalSaveBtn">Save</button>
      </div>
    </div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
