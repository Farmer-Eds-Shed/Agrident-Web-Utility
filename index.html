<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Agrident Web Utility</title>
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <h1>Agrident Web Utility</h1>
  <div class="muted">Agrident/Allflex Data Downloader</div>

  <!-- Connection / Status -->
  <div class="card cardCompact" id="connCard">
    <div class="topRow" id="connTypeRow">
      <label for="connType">Connection:</label>
      <select id="connType">
        <option value="ble">Bluetooth (BLE)</option>
        <option value="serial">USB Serial (COM)</option>
      </select>
      <span class="muted" id="connHint" style="margin-left:auto;"></span>
    </div>

    <div class="btnRow" style="margin-top:8px;">
      <button id="connectBtn">Connect</button>
      <button id="disconnectBtn" disabled>Disconnect</button>
    </div>

    <div class="pillRow" style="margin-top:8px;">
      <span id="status" class="pill bad">Disconnected</span>
      <span id="busy" class="pill">idle</span>
    </div>

    <details id="connMore" class="connMore">
      <summary>Connection details</summary>
      <div class="connMeta">
        <span class="muted" id="deviceName"></span>
        <span class="muted" id="syncedAt"></span>
      </div>
    </details>
  </div>

  
  <!-- Tabs: Tasks / Groups -->
  <div class="card">
    <div class="row" style="gap:10px; margin-bottom:10px;">
      <button class="btn btnSmall btnPrimary" id="tabGroupsBtn" type="button">Groups</button>
      <button class="btn btnSmall" id="tabTasksBtn" type="button">Tasks</button>
      <span class="muted" style="margin-left:auto;" id="activeTabHint">Groups</span>
    </div>

    <!-- Tasks panel -->
    <div id="panelTasks" style="display:none;">
      <div class="row" style="gap:10px; margin-bottom:10px;">
        <button class="btn btnSmall" id="syncTasksBtn" disabled>Sync Tasks</button>
        
        <label class="muted" for="taskSelect">Task:</label>
        <select id="taskSelect" disabled>
          <option value="">(connect to load tasks)</option>
        </select>
        <button id="downloadCsvBtn" disabled>Download CSV</button>
        
      </div>

      <h3 style="margin:0 0 6px;">Preview</h3>
      <div class="muted" id="previewMeta">No task selected.</div>

      <div class="scroll" style="max-height: 320px;">
        <table>
          <thead><tr id="previewHead"></tr></thead>
          <tbody id="previewBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Groups panel -->
    <div id="panelGroups">
      <div class="row" style="gap:10px; margin-bottom:10px;">
        <button class="btn btnSmall" id="syncGroupsBtn" disabled>Sync Groups</button>

        <label class="muted" for="groupSelect">Group:</label>
        <select id="groupSelect" disabled>
          <option value="">(sync groups)</option>
        </select>

        <label class="muted" style="display:flex; align-items:center; gap:6px;">
          <input type="checkbox" id="preferGroupX" checked />
          Prefer XGGROUPX (weight)
        </label>

        <button id="downloadGroupCsvBtn" disabled>Download Group CSV</button>
      </div>

      <h3 style="margin:0 0 6px;">Preview</h3>
      <div class="muted" id="groupPreviewMeta">No group selected.</div>

      <div class="scroll" style="max-height: 320px;">
        <table>
          <thead><tr id="groupPreviewHead"></tr></thead>
          <tbody id="groupPreviewBody"></tbody>
        </table>
      </div>

      <div class="muted" id="groupsSyncedAt" style="margin-top:8px;"></div>
    </div>
  </div>

  <!-- Modal editor -->
  <div id="overlay" class="overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modalHeader">
        <div class="modalTitle" id="modalTitle">Edit Row</div>
        <span class="modalSubtitle" id="modalSubtitle"></span>
        <span class="modalHeaderSpacer"></span>
        <button class="btn btnSmall" id="modalCloseBtn" title="Close">âœ•</button>
      </div>

      <div class="modalBody">
        <div class="muted" style="margin-bottom:10px;">
          Tip: Date columns accept <code>08022026</code>, <code>08-02-26</code>, <code>2026-02-08</code> and will export as <code>dd/mm/yyyy</code>.
        </div>
        <div id="modalGrid" class="grid"></div>
      </div>

      <div class="modalFooter">
        <button class="btn" id="modalCancelBtn">Cancel</button>
        <button class="btn btnDanger" id="modalDeleteBtn">Delete Row</button>
        <button class="btn btnPrimary" id="modalSaveBtn">Save</button>
      </div>
    </div>
  </div>

<script type="module" src="./app.js"></script>
</body>
</html>